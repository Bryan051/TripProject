<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>코스 상세</title>
<link rel="stylesheet" href="/resources/css/reset.css"	type="text/css">
<link
	href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400&display=swap"
	rel="stylesheet">
	<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.1/css/swiper.min.css">
<style type="text/css">
/* 팝업 컨테이너 스타일 */
.place_popup-container {
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: rgba(0, 0, 0, 0.5);
	display: flex;
	align-items: center;
	justify-content: center;
	z-index: 9999;
}

/* 팝업 내부 스타일 */
.place_popup {
	position: relative;
	background-color: #fff;
	padding: 20px;
	max-width: 800px;
	max-height: 95%;
	width: 800px;
	border-radius: 5px;
	box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
	border: 4px solid #B8E9FF; /* 테두리 추가 */
	box-sizing: border-box; /* 테두리를 요소 크기에 포함 */
	overflow-y: auto;
}

.place_popup img {
	width: 100%; /* 이미지를 꽉 차게 표시 */
	height: auto;
	margin: 0 auto;
	display: block;
}

.place_popup h1 {
	font-size: 24px;
	margin-bottom: 10px;
}

.place_popup p {
	margin-bottom: 10px;
	font-size:14px;
}

.place_popup-close {
	position: absolute;
	top: 10px;
	right: 10px;
	cursor: pointer;
	font-size: 20px;
	color: #888;
}
.place_popup-close-listEmpty{
	position: absolute;
	top: 185px;
    right: 570px;
	cursor: pointer;
	font-size: 20px;
	color: #888;
	
}

.place_popup img {
	max-width: 600px;
	max-height: 300px;
	width: auto;
	height: auto;
	margin: 0 auto;
	display: block;
}

.place_popup p.recommend {
	display: flex;
	align-items: center;
}

.place_popup p.recommend img {
	width: 16px;
	height: 16px;
	margin-right: 5px;
}

.place_popup p.recommend span {
	font-size: 14px;
}
.header {
	width: 90vw;
	border-bottom: 1px solid #EEEEEE;
	margin-left: auto;
	margin-right: auto;
	margin-bottom: 5vh;
	font-size: 1.8rem;
	display:grid;
	grid-template-rows: 13vh;
	font-weight:500;
	text-shadow:  -0.1px 0.1px 0 #000, 0.1px 0.1px 0 #000;
}

.header-category {
	display: flex;
	justify-content: center;
	align-items: center;
}
.header-left{
	flex:2;
	display: flex;
	justify-content: center;
	align-items: center;
}
.header-center{
	flex:3;
	display: flex;
	justify-content: center;
	align-items: center;
}
.header-right{
	flex:2;
	display: flex;
	justify-content: center;
	align-items: center;
}

#logimg {
	width: 280px;
	height: 160px;
	padding-right:1vw;
}

#label-left-plan {
	margin: auto;
}

#label-left-course {
	margin: auto;
}

#label-left-community {
	margin: auto;
}

#label-left-chat {
	margin: auto;
}

#label-right-login {
	padding-left: 1vw;
	padding-right: 1vw;
	margin-left: 3vw;
}

#label-right-register {
	margin-left: 3vw;
}
.body{
	display: flex;
	width: 98vw;
	height: 100%;
	flex-direction: column;
	position:relative;

	justify-content: center;
	align-items: center;
	
}

.map{
	display:flex;
	position:relative;
	justify-content: center;
	margin:1rem;
}
#map_div{
	text-align:center;
}
/* 경로 버튼 부분 */
.coursebtn{
	position: relative;
	
}

/* day 1  텍스트 부분 */
.mymain_text{
	width:20vw;
	font-size:1.8rem;
	margin:1rem;
	margin-bottom:0;
	margin-top: 6vh;
	position:relative;
	display:flex;
	justify-content:center;
	right: 16vw;
	height: 6vh;
	margin-left: 1.5vw;
}
.day1{
	border: solid;
	border-color: #B8E9FF;
	border-radius:0.5rem;
	border-width:2px;
	background-color: #B8E9FF;
	font-size: 2rem;
	color:white;
	padding: 1rem;
	padding-left:2rem;
	padding-right:2rem;
	display: flex;
	justify-content: center;
  	align-items: center;
	width:5vw;
	height:3.5vh;
}
.day2{
	width:6vw;
	margin:0.7rem;
	text-align:center;
	display: flex;
	flex-direction: column;
  	align-items: center;
  	justify-content: center;
}
.day3{
	margin:0.2rem;
	text-align:center;
}
/* 코스보여주는곳 */
/* 큰덩어리 */
.mymain{
	display: flex;
  	align-items: center;
	flex-direction: column;
	height: 70vh;
	margin: 2rem;
	margin-top:0;
	margin-bottom:5vh;
	overflow:auto;
}
.mymain::-webkit-scrollbar {
	display: none;
	font-family: 'Noto Sans KR Light', sans-serif;
}
.main{
	display:flex;
	width:45vw;
	height:12vh;
	border:solid;
	border-radius:1rem;
	border-width: 0.1rem;
	border-color: #BFBFBF;
	margin: 2rem;
	
	justify-content: center;
  	align-items: center;
	
}
.sec1{
	flex:1;
	margin:1rem;
	display:flex;
	justify-content: center;
	align-items:center;
	
}
.num{
	width:3rem;
	height:3rem;
	margin:1rem;
}
.sec2{
	flex:1;
	margin:1rem;
	
}
.placepic{
	width:13rem;
	height:8rem;
}
.sec3{
	flex:2;
	margin:1rem;
	
}
.placename{
	font-size:1.6rem;
}
.sec4{
	display:flex;
	flex:1;
	margin:1rem;
	
}
.sec4 > img{
	 cursor: pointer;
}
.info{
	width:4rem;
	height:4rem;
	margin:1rem;
	cursor:pointer;
}
.location{
	width:4rem;
	height:4rem;
	margin:1rem;
}
.courseinfobox{
	display:flex;
	align-items:center;
	width:50vw;
	font-size: 20px;
}

.left{
	display:flex;
	flex:9;
}
.courseInfo-title{
	display:flex;
	justify-content: left;
}
.courseInfo-date{
	margin-left:1vw;
	margin-right:auto;
	display:flex;
	justify-content: left;
}
.right{
	display:flex;
	flex:2;
}
#courseInfo-installText{
	margin-left:1vw;
	margoin-right:0;
	display:flex;
	justify-content: right;
}
#coursedetail-img{
	width:3vh;
	height:2.5vh;
	display:flex;
	justify-content: right;
	cursor: pointer;
}


.swiper-container {
	width: 50%; 
	height: 17vh;
}
.swiper-slide {
	width:15vw;
	height: 10vh;
	text-align: center;
	 /* 내용을 중앙정렬 하기위해 flex 사용 */
	align-items: center; /* 위아래 기준 중앙정렬 */
	justify-content: center; /* 좌우 기준 중앙정렬 */
	
}
.swiper-slide {
    position: relative;
    height: 10vh;
    bottom: 1.5vh;    
  }
.swiper-slide img {
	width:100%;
	height:100%;
	box-shadow: 0 0 5px #555;
	max-width: 100%; /* 이미지 최대너비를 제한, 슬라이드에 이미지가 여러개가 보여질때 필요 */
}
.swiper-slide-day{
	margin-top: 2vh;
	margin-bottom: 1vh;
	width: 100%;
	display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
.swiper-slide-day>button{
	font-weight: bold;
	margin-bottom:1vh;
}
.allDay-img-div {
	width: 8vw;
    height: 10vh;
    /* display: flex;
    justify-content: center;
 */
}
.day-img-div{
	width: 8vw;
    height: 10vh;
   	/* display: flex;
    justify-content: center; */

}
 .swiper-pagination-bullet-active{
  	background:#B8E9FF;
  }
  .swiper-button-prev, .swiper-container-rtl .swiper-button-next {
  	background-image: url(/resources/image/mainArrowleft.png);
  	
  }
  .swiper-button-next, .swiper-container-rtl .swiper-button-next {
  	background-image: url(/resources/image/mainArrowRight.png);
  }
  #courseInfo-installText{
  	margin-right:0.5vw;
  }
  
</style>

<script
	src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=L9YT0x6My9adXfumw1zGi2Gs24KLX3qS7depPI37"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script	src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.1/js/swiper.min.js"></script>

</head>

<body>
<div class="header">
		<div class="header-category">
			<div class="header-left">
				<a href="/plan" id="label-left-plan">일정 만들기</a>
				<a href="/course/recommandcourse" id="label-left-course">코스추천</a>
				 <a href="/community/communitymain" id="label-left-community">커뮤니티</a> 
				 <a href="/chatting" id="label-left-chat">동행구하기</a>
			</div>
			<div class="header-center">
				<a href="/"><img src="/resources/image/logo.png" alt="" id="logimg"></a>
			</div>
				<!-- 로그인전 --> 
			<div class ="header-right" th:if="${session.login == null}">
				<a href="/login" id="label-right-login">로그인</a> 
				<a href="/login/registerform" id="label-right-login">회원가입</a>
			</div>
				<!-- 로그인 후 -->
			<div class ="header-right" th:if="${session.login != null}" >
				<a href="/login/logout" id="label-right-login">로그아웃</a>
				<a href="/login/usermain" id="label-right-register">마이페이지</a>
			</div> 
		</div>
	</div>
	<div class="body">
		<div class="courseinfobox">
				<div class="left">
					<div class="courseInfo-title">[[${coursedetail.shareID}]] 의 [[${coursedetail.planName}]]</div>
					<div class="courseInfo-date">[[${coursedetail.courseFirstDate}]] ~ [[${coursedetail.courseLastDate}]]</div>
				</div>
				<div class="right">
					<div id="courseInfo-installText">저장하기</div>
					<div id="coursedetail-img"><img src="/resources/image/save.png"></div>
				</div>
		</div>
		<!--  지도  -->
		<div class="map">
			<div id="map_div"></div>
		</div>
		<!-- 지도 밑 버튼 (경로 불러오는), 화면설계서랑 다름 -->
		<div class="swiper-container" id="swiper-container-course">
			<div class="swiper-wrapper">
			</div>
		<!-- 네비게이션 -->
		<div class="swiper-button-next" id="swiper-button-next-course"></div>
		<!-- 다음 버튼 (오른쪽에 있는 버튼) -->
		<div class="swiper-button-prev" id="swiper-button-prev-course"></div>
		<!-- 이전 버튼 -->

		<!-- 페이징 -->
		<div class="swiper-pagination" id="swiper-pagination-course"></div>
		</div>
		<!-- 밑에 리스트 -->
	<!-- 	<div class="mymain_text"> -->
		</div>
		<div class="mymain">
		</div>
	
</body>

<script th:inline="javascript">
//장소별 팝업창
var place = [[${placeInfo}]];
var courseimage = [[${courseimage}]];
	
function placePopup(placeName) {
  $.ajax({
    url: '/course/info',
    type: 'POST',
    data: { placeName: placeName },
    success: function(response) {
      openPopup(response.placeName, response.placeAddress, response.placePhone, response.placeContent, response.placeInfo, response.placeGood);
    },
    error: function(error) {
      console.error('Error:', error);
    }
  });
}

function openPopup(placeName,placeAddress,  placePhone, placeContent, placeInfo, placeGood, imagePath) {
	  var popupContainer = document.createElement("div");
	  popupContainer.setAttribute("id", "place_popupContainer");
	  popupContainer.setAttribute("class", "place_popup-container");

	  var popup = document.createElement("div");
	  popup.setAttribute("class", "place_popup");

	  popup.innerHTML = `
	  <br>
	  <div class="popup_imgcontainer">
		<img src="/resources/image/place/${placeName}.jpg">
		</div>
		<br><hr><br><br>
	    <h1>${placeName}</h1>
	    <br>
	    <p>📍 ${placeAddress}</p>
	    <p>📞 ${placePhone}</p>
	    <p>✔️ ${placeInfo}</p>
	    <br>

	    <p>${placeContent}</p><br><br><hr>
	    <br>
	    <p class="recommend"><img src="/resources/image/insta_heart.png"/><span>추천수: ${placeGood}</span></p>
	    <span class="place_popup-close" onclick="closePopup()">X </span>
	    	`;

	  popupContainer.appendChild(popup);
	  document.body.appendChild(popupContainer);
	}


function closePopup() {
  var popupContainer = document.getElementById("place_popupContainer");
  if (popupContainer) {
    popupContainer.parentNode.removeChild(popupContainer);
  }
}
	
	  map = new Tmapv2.Map("map_div", {
	    center: new Tmapv2.LatLng(33.3616666, 126.5291666),
	    width: "50vw", // 지도의 넓이
	    height: "50vh", // 지도의 높이
	    zoom: 10
	  });
	  
	  var new_polyLine = [];
	  var new_Click_polyLine = [];
	  function drawData(data, color){
		  	// 지도위에 선은 다 지우기
		  	routeData = data;
		  	var resultStr = "";
		  	var distance = 0;
		  	var idx = 1;
		  	var newData = [];
		  	var equalData = [];
		  	var pointId1 = "-1234567";
		  	var ar_line = [];
		  	
		  	
		  	for (var i = 0; i < data.features.length; i++) {
		  		var feature = data.features[i];
		  		//배열에 경로 좌표 저장
		  		if(feature.geometry.type == "LineString"){
		  			ar_line = [];
		  			for (var j = 0; j < feature.geometry.coordinates.length; j++) {
		  				var startPt = new Tmapv2.LatLng(feature.geometry.coordinates[j][1],feature.geometry.coordinates[j][0]);
		  				ar_line.push(startPt);
		  				pointArray.push(feature.geometry.coordinates[j]);
		  			}
		  			var polyline = new Tmapv2.Polyline({
		  		        path: ar_line,
		  		        strokeColor: color, 
		  		        strokeWeight: 3,
		  		        map: map
		  		    });
		  			new_polyLine.push(polyline);
		  		}
		  		var pointId2 = feature.properties.viaPointId;
		  		if (pointId1 != pointId2) {
		  			equalData = [];
		  			equalData.push(feature);
		  			newData.push(equalData);
		  			pointId1 = pointId2;
		  		}
		  		else {
		  			equalData.push(feature);
		  		}
		  	}
		  	geoData = newData;
		  	var markerCnt = 1;
		  	for (var i = 0; i < newData.length; i++) {
		  		var mData = newData[i];
		  		var type = mData[0].geometry.type;
		  		var pointType = mData[0].properties.pointType;
		  		var pointTypeCheck = false; // 경유지 일때만 true
		  		if (mData[0].properties.pointType == "S") {
		  			var img = 'http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png';
		  			var lon = mData[0].geometry.coordinates[0];
		  			var lat = mData[0].geometry.coordinates[1];
		  		}
		  		else if (mData[0].properties.pointType == "E") {
		  			var img = 'http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_e.png';
		  			var lon = mData[0].geometry.coordinates[0];
		  			var lat = mData[0].geometry.coordinates[1];
		  		}
		  		else {
		  			markerCnt=i;
		  			var lon = mData[0].geometry.coordinates[0];
		  			var lat = mData[0].geometry.coordinates[1];
		  		}	
		  	}
		  }


		  // 2. 시작, 도착 심볼찍기
		  var markerList = [];
		  var pointArray = [];
		  var markers = [];
		
		  var inputValues = [[${coursemarker}]];
		  var dates = Object.keys(inputValues[0]); // 날짜 배열 얻기
		  // 버튼을 추가할 컨테이너 선택
		  var buttonContainer = document.getElementsByClassName('swiper-wrapper')[0];

		  var allButtonSwiperContent = document.createElement('div');
		  allButtonSwiperContent.className = "swiper-slide";
		  
		  var allDayButtondiv = document.createElement('div');
		  allDayButtondiv.className = "swiper-slide-day";
		  
		  var allDayImgdiv = document.createElement('div');
		  allDayImgdiv.className= "allDay-img-div";
	      var allImage = document.createElement('img');
	      allImage.src = '/resources/image/allDayImg3.jpg';
	      var allDaybutton = document.createElement('button');
			allDaybutton.textContent = 'All Day';

			allDaybutton.addEventListener('click', function() {
				  showAllDayRoute();
				  allMainContent(dates)
				});
			
	      allDayImgdiv.appendChild(allImage);
	      allDayButtondiv.appendChild(allDaybutton);
	      allDayButtondiv.appendChild(allDayImgdiv);
	      allButtonSwiperContent.appendChild(allDayButtondiv);
	      buttonContainer.appendChild(allButtonSwiperContent);
		  for (var i = 0; i < dates.length; i++) {
			  
			  var buttonSwiperContent = document.createElement('div');
			  buttonSwiperContent.className = "swiper-slide";
			  
			  var dayButtondiv = document.createElement('div');
			  dayButtondiv.className = "swiper-slide-day";
			  
		      var daybutton = document.createElement('button');
		      daybutton.textContent = 'Day ' + (i + 1);
		      
		      dayButtondiv.appendChild(daybutton);
		      buttonSwiperContent.appendChild(dayButtondiv);
		      
		      var dayImgdiv = document.createElement('div');
		      dayImgdiv.className= 'day-img-div';
		      var image = document.createElement('img');
		      image.src = '/resources/image/place/'+courseimage[i].placeName+'.jpg';
		      
		      dayImgdiv.appendChild(image);
		      dayButtondiv.appendChild(dayImgdiv);
		      buttonSwiperContent.appendChild(dayButtondiv);
		      buttonContainer.appendChild(buttonSwiperContent);
		      // 클릭 이벤트 처리	
		      daybutton.addEventListener('click', function(event) {
		    	 var buttons = Array.from(buttonContainer.getElementsByTagName('button'));
		        var buttonIndex = buttons.indexOf(event.target);
		        var date = dates[buttonIndex - 1];
		        var selectedInputValue = inputValues[0][date];
		        var color = selectedInputValue.color;
		        var lonLatPairs = selectedInputValue.lonLatPairs;
		        var placeName = selectedInputValue.placeName;
				  updateMainContent(date, placeName, lonLatPairs, buttonIndex);

		        clearMarkers()
		        clearRoutes(); // 기존의 경로 삭제
		        drawRoute(date, lonLatPairs, color);
		      });
		  }
		  
		  function updateMainContent(date, placeName, lonLatPairs, buttonIndex) {
			  
			  var mymainDiv = document.querySelector('.mymain');
			  mymainDiv.innerHTML = ''; // 기존 내용 초기화
			  var mymainText = document.createElement('div');
			  mymainText.className = 'mymain_text';
  			  var day1Div = document.createElement('div');
  			  day1Div.className = 'day1';
  			  day1Div.textContent = 'Day' + (buttonIndex);
  			  mymainText.appendChild(day1Div);

  			// day2 요소
  			var day2Div = document.createElement('div');
  			day2Div.className = 'day2';
  			day2Div.textContent = date;
  			mymainText.appendChild(day2Div);
  			mymainDiv.appendChild(mymainText);
			  for (var i = 0; i < lonLatPairs.length; i++) {
				  (function(i) {
			    var mainDiv = document.createElement('div');
			    mainDiv.className = 'main';
			    mymainDiv.appendChild(mainDiv);
				
			    var sec1 = document.createElement('div');
			    sec1.className = 'sec1';
			    var numImg = document.createElement('img');
			    numImg.className = 'num';
			    numImg.src = '/resources/image/nums' + (i + 1) + '.png';
			    sec1.appendChild(numImg);
				
			    var sec2 = document.createElement('div');
			    sec2.className = 'sec2';
			    var placePicImg = document.createElement('img');
			    placePicImg.className = 'placepic';
			    placePicImg.src = '/resources/image/place/' + placeName[i].placeName + '.jpg';
			    sec2.appendChild(placePicImg);

			    var sec3 = document.createElement('div');
			    sec3.className = 'sec3';
			    var placeNameDiv = document.createElement('div');
			    placeNameDiv.className = 'placename';
			    placeNameDiv.textContent = placeName[i].placeName;
			    sec3.appendChild(placeNameDiv);

			    var sec4 = document.createElement('div');
			    sec4.className = 'sec4';
			    var infoImg = document.createElement('img');
			    infoImg.className = 'info';
			    infoImg.src = '/resources/image/exclamationmark.png';
			    sec4.appendChild(infoImg);
			    infoImg.addEventListener('click', function(event) {
			    	placePopup(placeName[i].placeName);
			    });

			    mainDiv.appendChild(sec1);
			    mainDiv.appendChild(sec2);
			    mainDiv.appendChild(sec3);
			    mainDiv.appendChild(sec4);
			  })(i);
			}
		  }
		
		  function allMainContent(dates) {
			  var mymainDiv = document.querySelector('.mymain');
			  mymainDiv.innerHTML = ''; // 기존 내용 초기화

			for(var i = 0; i < dates.length; i++){
				
				var date = dates[i];
				var item = inputValues[0][date];
				var placeName = item.placeName;
				var lonLatPairs = item.lonLatPairs;
				var mymainTextdiv = document.createElement('div');
				mymainTextdiv.className = 'mymain_text';
  				var day1Div = document.createElement('div');
  				day1Div.className = 'day1';
  				day1Div.textContent = 'Day' + (i+1);
  				mymainTextdiv.appendChild(day1Div);

  				var day2Div = document.createElement('div');
  				day2Div.className = 'day2';
  				day2Div.textContent = date;
  				mymainTextdiv.appendChild(day2Div);
  				mymainDiv.appendChild(mymainTextdiv);
  				
			  for (var j = 0; j < lonLatPairs.length; j++) {
			    var mainDiv = document.createElement('div');
			    mainDiv.className = 'main';
			    mymainDiv.appendChild(mainDiv);
				
			    var sec1 = document.createElement('div');
			    sec1.className = 'sec1';
			    var numImg = document.createElement('img');
			    numImg.className = 'num';
			    numImg.src = '/resources/image/nums' + (j + 1) + '.png';
			    sec1.appendChild(numImg);
				
			    var sec2 = document.createElement('div');
			    sec2.className = 'sec2';
			    var placePicImg = document.createElement('img');
			    placePicImg.className = 'placepic';
			    placePicImg.src = '/resources/image/place/' + placeName[j].placeName + '.jpg';
			    sec2.appendChild(placePicImg);

			    var sec3 = document.createElement('div');
			    sec3.className = 'sec3';
			    var placeNameDiv = document.createElement('div');
			    placeNameDiv.className = 'placename';
			    placeNameDiv.textContent = placeName[j].placeName;
			    sec3.appendChild(placeNameDiv);

			    var sec4 = document.createElement('div');
			    sec4.className = 'sec4';
			    var infoImg = document.createElement('img');
			    infoImg.className = 'info';
			    infoImg.src = '/resources/image/exclamationmark.png';
			    infoImg.dataset.placeName = placeName[j].placeName; // placeName 값을 data-place-name 속성으로 저장
			    infoImg.addEventListener('click', function(event) {
			    	 var clickedImg = event.target; // 클릭된 이미지 요소를 참조
			    	  var clickedPlaceName = clickedImg.dataset.placeName; // 클릭된 이미지의 data-place-name 속성 값을 읽어옴
			    	  placePopup(clickedPlaceName);
			      });
			    sec4.appendChild(infoImg);

			    mainDiv.appendChild(sec1);
			    mainDiv.appendChild(sec2);
			    mainDiv.appendChild(sec3);
			    mainDiv.appendChild(sec4);
			  }
			}
		  }

		  function clearRoutes() {
		      if (new_polyLine.length > 0) {
		          for (var i = 0; i < new_polyLine.length; i++) {
		              new_polyLine[i].setMap(null);
		          }
		          new_polyLine = [];
		      }
		      if (new_Click_polyLine.length > 0) {
		          for (var i = 0; i < new_Click_polyLine.length; i++) {
		              new_Click_polyLine[i].setMap(null);
		          }
		          new_Click_polyLine = [];
		      }
		  }
		  function clearMarkers() {
		  	  for (var i = 0; i < markers.length; i++) {
		  	    markers[i].setMap(null);
		  	  }
		  	  markers = [];
		  	}
		  function showAllDayRoute() {
			  // 기존 마커 지우기
			  clearMarkers();
		for (var i = 0; i < dates.length; i++) {
			var date = dates[i];
			var item = inputValues[0][date];
			var color = item.color;
			var lonLatPairs = item.lonLatPairs;
			var waypoints = lonLatPairs.slice(1, lonLatPairs.length - 1);
			if(lonLatPairs.length === 1){
				addMarker("llPass", lonLatPairs[0].lat, lonLatPairs[0].lon, 1, color);
			}else{

			// 시작
			addMarker("llStart", lonLatPairs[0].lat, lonLatPairs[0].lon, 1, color);
			// 도착
			addMarker("llEnd", lonLatPairs[lonLatPairs.length - 1].lat, lonLatPairs[lonLatPairs.length - 1].lon, 2, color);

			// 경유지 심볼 찍기
			for (var j = 0; j < waypoints.length; j++) {
				var waypoint = waypoints[j];
				addMarker("llPass", waypoint.lat, waypoint.lon, j + 3, color);
			}
			// 4. 경로탐색 API 사용요청
			}
			var startX = lonLatPairs[0].lat;
			var startY = lonLatPairs[0].lon;
			var endX = lonLatPairs[lonLatPairs.length - 1].lat;
			var endY = lonLatPairs[lonLatPairs.length - 1].lon;
			var passList = waypoints.map(function(waypoint) {
				  return waypoint.lat + ',' + waypoint.lon;
				}).join('_');
			var prtcl;
			var headers = {};
			
			headers["appKey"]="L9YT0x6My9adXfumw1zGi2Gs24KLX3qS7depPI37";
			$.ajax({
					method:"POST", 
					headers : headers, 
					url:"https://apis.openapi.sk.com/tmap/routes?version=1&format=json",//
					async:false,
					data:{ 
						startX : startX,
						startY : startY,
						endX : endX,
						endY : endY,
						passList : passList,
						reqCoordType : "WGS84GEO",
						resCoordType : "WGS84GEO",
						angle : "172",
						searchOption : "0",
						trafficInfo : "N"
					},
					success:function(response){
					prtcl = response;
					
					// 5. 경로탐색 결과 Line 그리기 
					var trafficColors = {
						extractStyles:true,
						/* 실제 교통정보가 표출되면 아래와 같은 Color로 Line이 생성됩니다. */
						trafficDefaultColor:"#636f63", //Default
						trafficType1Color:"#19b95f", //원할
						trafficType2Color:"#f15426", //지체
						trafficType3Color:"#ff970e"  //정체		
					};    			
					var style_red = {
						fillColor:"#FF0000",
						fillOpacity:0.2,
						strokeColor: "#FF0000",
						strokeWidth: 3,
						strokeDashstyle: "solid",
						pointRadius: 2,
						title: "this is a red line"
					};
					drawData(prtcl, color);
				
				
		 			// 6. 경로탐색 결과 반경만큼 지도 레벨 조정
					  var center = new Tmapv2.LatLng(33.3616666, 126.5291666);
					  var zoom = 10; // 현재 줌 레벨 가져오기
					  map.setCenter(center);
					  map.setZoom(zoom);
					},
					error:function(request,status,error){
				}
			});
			}
		  }
		  	function addMarker(status, lon, lat, tag, color) {
		  	//출도착경유구분
		  	//이미지 파일 변경.
		  	var markerLayer;
		  	switch (status) {
		  		case "llStart":
		  			img = '/resources/image/marker/'+color+'start.png';
		  			break;
		  		case "llPass":
		  			img = '/resources/image/marker/'+color+'pass.png';
		  			break;
		  		case "llEnd":
		  			img = '/resources/image/marker/'+color+'end.png';
		  			break;
		  		default:
		  	};
		  	var marker = new Tmapv2.Marker({
		  		position: new Tmapv2.LatLng(lat,lon),
		  		icon: img,
		  		map: map
		  	});
		  	// 마커 드래그 설정
		  	marker.tag = tag;
		  	marker.addListener("dragend", function (evt) {
		  	markerListenerEvent(evt);
		      });
		      marker.addListener("drag", function (evt) {    	
		      	markerObject = markerList[tag];
		      });
		      markerList[tag] = marker;
		      markers.push(marker);
		      return marker;
		  } 
		  	
		  	 function drawRoute(date, lonLatPairs, color) {
		  			var waypoints = lonLatPairs.slice(1, lonLatPairs.length - 1);
		  			if(lonLatPairs.length === 1){
		  				addMarker("llPass", lonLatPairs[0].lat, lonLatPairs[0].lon, 1, color);
		  			// 4. 경로탐색 API 사용요청
					      var startX = lonLatPairs[0].lat;
					      var startY = lonLatPairs[0].lon;
					      var endX = lonLatPairs[lonLatPairs.length - 1].lat;
					      var endY = lonLatPairs[lonLatPairs.length - 1].lon;
					      var passList = waypoints.map(function(waypoint) {
					        return waypoint.lat + ',' + waypoint.lon;
					      }).join('_');
					      var prtcl;
					  	  var headers = {};
					      
					      headers["appKey"]="L9YT0x6My9adXfumw1zGi2Gs24KLX3qS7depPI37";
					      // 경로 탐색 API 호출
							$.ajax({
								method:"POST", 
								headers : headers, 
								url:"https://apis.openapi.sk.com/tmap/routes?version=1&format=json",//
								async:false,
								data:{ 
									startX : startX,
									startY : startY,
									endX : endX,
									endY : endY,
									passList : passList,
									reqCoordType : "WGS84GEO",
									resCoordType : "WGS84GEO",
									angle : "172",
									searchOption : "0",
									trafficInfo : "N"
								},
								success:function(response){
								prtcl = response;
								
								// 5. 경로탐색 결과 Line 그리기 
								var trafficColors = {
									extractStyles:true,
									/* 실제 교통정보가 표출되면 아래와 같은 Color로 Line이 생성됩니다. */
									trafficDefaultColor:"#636f63", //Default
									trafficType1Color:"#19b95f", //원할
									trafficType2Color:"#f15426", //지체
									trafficType3Color:"#ff970e"  //정체		
								};    			
								var style_red = {
									fillColor:"#FF0000",
									fillOpacity:0.2,
									strokeColor: "#FF0000",
									strokeWidth: 3,
									strokeDashstyle: "solid",
									pointRadius: 2,
									title: "this is a red line"
								};
								drawData(prtcl, color);
							
							
								// 6. 경로탐색 결과 반경만큼 지도 레벨 조정
								  var center = new Tmapv2.LatLng(lonLatPairs[0].lon, lonLatPairs[0].lat);
								  var zoom = 16; // 현재 줌 레벨 가져오기
								  map.setCenter(center);
								  map.setZoom(zoom);
								},
								error:function(request,status,error){
							}
						});
					      
		  			}else{

		  			// 시작
		  			addMarker("llStart", lonLatPairs[0].lat, lonLatPairs[0].lon, 1, color);
		  			// 도착
		  			addMarker("llEnd", lonLatPairs[lonLatPairs.length - 1].lat, lonLatPairs[lonLatPairs.length - 1].lon, 2, color);

		  			// 경유지 심볼 찍기
		  			for (var j = 0; j < waypoints.length; j++) {
		  				var waypoint = waypoints[j];
		  				addMarker("llPass", waypoint.lat, waypoint.lon, j + 3, color);
		  			}
		  			// 4. 경로탐색 API 사용요청
		  			}
		  	      var startX = lonLatPairs[0].lat;
		  	      var startY = lonLatPairs[0].lon;
		  	      var endX = lonLatPairs[lonLatPairs.length - 1].lat;
		  	      var endY = lonLatPairs[lonLatPairs.length - 1].lon;
		  	      var passList = waypoints.map(function(waypoint) {
		  	        return waypoint.lat + ',' + waypoint.lon;
		  	      }).join('_');
		  	      var prtcl;
		  	  	  var headers = {};
		  	      
		  	      headers["appKey"]="L9YT0x6My9adXfumw1zGi2Gs24KLX3qS7depPI37";
		  	      // 경로 탐색 API 호출
		  			$.ajax({
		  				method:"POST", 
		  				headers : headers, 
		  				url:"https://apis.openapi.sk.com/tmap/routes?version=1&format=json",//
		  				async:false,
		  				data:{ 
		  					startX : startX,
		  					startY : startY,
		  					endX : endX,
		  					endY : endY,
		  					passList : passList,
		  					reqCoordType : "WGS84GEO",
		  					resCoordType : "WGS84GEO",
		  					angle : "172",
		  					searchOption : "0",
		  					trafficInfo : "N"
		  				},
		  				success:function(response){
		  				prtcl = response;
		  				
		  				// 5. 경로탐색 결과 Line 그리기 
		  				var trafficColors = {
		  					extractStyles:true,
		  					/* 실제 교통정보가 표출되면 아래와 같은 Color로 Line이 생성됩니다. */
		  					trafficDefaultColor:"#636f63", //Default
		  					trafficType1Color:"#19b95f", //원할
		  					trafficType2Color:"#f15426", //지체
		  					trafficType3Color:"#ff970e"  //정체		
		  				};    			
		  				var style_red = {
		  					fillColor:"#FF0000",
		  					fillOpacity:0.2,
		  					strokeColor: "#FF0000",
		  					strokeWidth: 3,
		  					strokeDashstyle: "solid",
		  					pointRadius: 2,
		  					title: "this is a red line"
		  				};
		  				drawData(prtcl, color);
		  			
		  			
		  				// 6. 경로탐색 결과 반경만큼 지도 레벨 조정
		  				var newData = geoData[0];
		  				PTbounds = new Tmapv2.LatLngBounds();
		  						for (var i = 0; i < newData.length; i++) {
		  							var mData = newData[i];
		  							var type = mData.geometry.type;
		  							var pointType = mData.properties.pointType;
		  							if(type == "Point"){
		  								var linePt = new Tmapv2.LatLng(mData.geometry.coordinates[1],mData.geometry.coordinates[0]);
		  								PTbounds.extend(linePt);
		  							}
		  							else{
		  								var startPt,endPt;
		  								for (var j = 0; j < mData.geometry.coordinates.length; j++) {
		  									var linePt = new Tmapv2.LatLng(mData.geometry.coordinates[j][1],mData.geometry.coordinates[j][0]);
		  									PTbounds.extend(linePt);
		  								}
		  						}
		  					}
		  					map.fitBounds(PTbounds);
		  			
		  				},
		  				error:function(request,status,error){
		  			}
		  		});
		  	    }
		  // 요소 가져오기
		    var userID = [[${session.login}]];
		  	var imgWrapper = document.getElementById("coursedetail-img");
		  	var planName = [[${coursedetail.planName}]];
		  	var shareID = [[${coursedetail.shareID}]];
		  	
		  	// 클릭 이벤트 핸들러 함수 정의
		  	function handleClick() {
		  	  // 클릭 이벤트 발생 시 실행할 동작을 여기에 작성합니다.
		  	  	$.ajax({
					url:'/course/save',
					type: 'POST',
					data: {saveID:userID,
						   shareID:shareID,
						   planName:planName
						},
					success: function(data){
						if(data === 1){
							alert("코스가 저장 되었습니다.");
							location.href='/login/usermain';
						}
					},
					error: function(data){
						alert(data);
					}
				});	
		  	  // 추가적인 동작을 수행하거나 다른 함수를 호출할 수 있습니다.
		  	}

		  	// 클릭 이벤트 핸들러 함수를 요소에 연결
		  	imgWrapper.addEventListener("click", handleClick);
		  	
		  	 window.onload = function() {
		  			// 기본적으로 전체 경로 표시하기
		  		allMainContent(dates);
		        showAllDayRoute();
		  	};
	 
</script>

<script type="text/javascript">
		new Swiper('.swiper-container', {

			slidesPerView : 3, // 동시에 보여줄 슬라이드 갯수
			spaceBetween : 10, // 슬라이드간 간격
			slidesPerGroup : 3, // 그룹으로 묶을 수, slidesPerView 와 같은 값을 지정하는게 좋음

			// 그룹수가 맞지 않을 경우 빈칸으로 메우기
			// 3개가 나와야 되는데 1개만 있다면 2개는 빈칸으로 채워서 3개를 만듬
			loopFillGroupWithBlank : true,

			loop : false, // 무한 반복

			pagination : { // 페이징
				el : '.swiper-pagination',
				clickable : true, // 페이징을 클릭하면 해당 영역으로 이동, 필요시 지정해 줘야 기능 작동
			},
			navigation : { // 네비게이션
				nextEl : '.swiper-button-next', // 다음 버튼 클래스명
				prevEl : '.swiper-button-prev', // 이번 버튼 클래스명
			},
		});
	</script>
</html>